<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Francis Van Roie">
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Commands - openHASP</title> 
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
<link rel="stylesheet" href="../css/ekko-lightbox.min.css">  
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
<script src="../js/ekko-lightbox.min.js"></script>
 
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "jsonl", url: "#_top", children: [
          ]},
          {title: "page", url: "#page", children: [
          ]},
          {title: "clearpage", url: "#clearpage", children: [
          ]},
          {title: "dim", url: "#dim", children: [
          ]},
          {title: "light", url: "#light", children: [
          ]},
          {title: "wakeup", url: "#wakeup", children: [
          ]},
          {title: "moodlight", url: "#moodlight", children: [
          ]},
          {title: "output[x]", url: "#outputx", children: [
          ]},
          {title: "System Commands", url: "#system-commands", children: [
          ]},
          {title: "Configuration Settings", url: "#configuration-settings", children: [
          ]},
          {title: "config/submodule", url: "#configsubmodule", children: [
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
<script>
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox();
    });
</script>
<!-- Cloudflare Web Analytics -->
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "d4bec0b78f6840c1afe0d7d21896a2e9"}'></script>
<!-- End Cloudflare Web Analytics -->
 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../faq/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../faq/" class="btn btn-xs btn-link">
        FAQ
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../example-lovelace/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../example-lovelace/" class="btn btn-xs btn-link">
        Lovelace Entities
      </a>
    </div>
    
  </div>

    

    <p>Commands are not related to an object on the screen but can get or set global properties or invoke system commands on the device.</p>
<p>Commands can be issued via the Serial commandline, telnet commandline or MQTT.</p>
<p>For MQTT, use the <code>hasp/&lt;nodename&gt;/command</code> topic with payload <code>&lt;keyword&gt; &lt;parameter(s)&gt;</code></p>
<h2 id="jsonl">jsonl<a class="headerlink" href="#jsonl" title="Permanent link">~</a></h2>
<p><em>accepted parameters:</em> json formatted lines     </p>
<p>Create new objects <em>or</em> update properties of an existing object. When updating an existing object the <code>obj</code> property is not required and will be ignored.</p>
<p>Each line in the <code>jsonl</code> payload defines one object and has to be in the json format. If the payload exceeds the MQTT buffer it will be cut off to fit, don't send too many lines in a single payload, you can always sends another command.</p>
<p>Example:    </p>
<pre><code class="language-json">jsonl {&quot;obj&quot;:&quot;btn&quot;,&quot;id&quot;:14,&quot;x&quot;:120,&quot;y&quot;:1,&quot;w&quot;:30,&quot;h&quot;:40,&quot;text_font&quot;:&quot;2&quot;,&quot;text&quot;:&quot;Test&quot;,&quot;text_color&quot;:&quot;gray&quot;,&quot;bg_opa&quot;:0,&quot;border_width&quot;:0}
</code></pre>
<p><em>For more details see <a href="../pages/">Pages</a> and <a href="../objects/">Objects</a></em></p>
<h2 id="page">page<a class="headerlink" href="#page" title="Permanent link">~</a></h2>
<p><em>accepted parameters:</em> <code>[0-12]</code>, <code>prev</code> or <code>next</code></p>
<p>Switches the display to show the objects from a different page and return the page number in <code>state/page</code>.</p>
<p>Calling the <code>page</code> command without a parameter will return the value of the current page in <code>state/page</code>.</p>
<h2 id="clearpage">clearpage<a class="headerlink" href="#clearpage" title="Permanent link">~</a></h2>
<p><em>accepted parameters:</em> <code>[0-12]</code> or <code>all</code></p>
<p>Deletes all objects on a given page. If no page number is specified, it clears the current page.
Use <code>clearpage all</code> to clear all objects on all pages.</p>
<p>To delete individual objects, you can issue the <code>pxby.delete</code> command.</p>
<h2 id="dim">dim<a class="headerlink" href="#dim" title="Permanent link">~</a></h2>
<p><em>accepted parameters:</em> <code>[0-255]</code></p>
<p>Sets the level of the backlight from 0 to 255, where 0 is off and 255 is full brightness.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code>dim 127</code> sets the display to half the brightness.</p>
</div>
<p>This can be used in conjunction with the <a href="../configuration/display/#short-idle">idle events</a>, e.g. to dim the screen after a period of inactivity.</p>
<h2 id="light">light<a class="headerlink" href="#light" title="Permanent link">~</a></h2>
<p><em>accepted parameters:</em> <code>on</code>/<code>off</code>, <code>true</code>/<code>false</code>, <code>0</code>/<code>1</code>, <code>yes</code>/<code>no</code></p>
<p>Switches the backlight on or off, independent of the set dim level. Turning the backlight on will restore the brightness to the previous dim level.</p>
<div class="admonition example">
<p class="admonition-title">Example</p>
<p><code>light on</code> Turn the backlight on </p>
</div>
<p><code>dim</code> and <code>light</code> commands will work only if a Backlight GPIO pin is configured to the pin required to control the display backlight.</p>
<p><code>dim 0</code> and <code>light 0</code> both turn off the screen, however, with <code>dim 0</code> the touching will haven an effect on the objects beneath but not wake the screen, while with <code>light 0</code> it will only wake the scren but will not affect the objects.</p>
<h2 id="wakeup">wakeup<a class="headerlink" href="#wakeup" title="Permanent link">~</a></h2>
<p>Clears the idle state of the device and publishes a <code>state/idle = OFF</code> status message.</p>
<p>It resets the idle counter as if a touch event occurred on the device. This is helpful e.g. when you want to wake up the display when an external event has occurred, like a PIR motion sensor.</p>
<h2 id="moodlight">moodlight<a class="headerlink" href="#moodlight" title="Permanent link">~</a></h2>
<p>An RGB moodlight can be controlled by configuring 3 <a href="../configuration/gpio/">GPIO pins</a> as type <code>Mood Red</code>, <code>Mood Green</code> and <code>Mood blue</code>.
These leds can then be controlled together using the <code>moodlight</code> command.</p>
<pre><code class="language-json">moodlight {&quot;state&quot;:&quot;off&quot;,&quot;color&quot;:&quot;green&quot;}
moodlight {&quot;state&quot;:true,&quot;color&quot;:&quot;#ff00e7&quot;}
moodlight {&quot;color&quot;:12345}
moodlight {&quot;state&quot;:&quot;on&quot;,&quot;r&quot;:255,&quot;g&quot;:0,&quot;b&quot;:255}
</code></pre>
<ul>
<li>The <code>state</code> key accepts <a href="../styling/#boolean">boolean values</a> to turn the moodlight on or off</li>
<li>The <code>color</code> key accepts <a href="../styling/#colors">color values</a> to set the RGB channels at once</li>
<li>Individual <code>r</code>, <code>g</code> and <code>b</code> keys can also be used to set each channel seperately</li>
</ul>
<p>Calling the <code>moodlight</code> command without parameters (or sending an empty payload to the <code>hasp/&lt;nodename&gt;/command/moodlight</code> topic) returns the current state:</p>
<pre><code class="language-json">    &quot;hasp/&lt;nodename&gt;/state/moodlight&quot; =&gt; {&quot;state&quot;:&quot;ON&quot;,&quot;color&quot;:{&quot;r&quot;:222,&quot;g&quot;:161,&quot;b&quot;:222}}
</code></pre>
<p>The color is returned as individual channels.</p>
<h2 id="outputx">output[x]<a class="headerlink" href="#outputx" title="Permanent link">~</a></h2>
<p>where <code>[x]</code> is number of the group (1-14)</p>
<p><em>accepted parameters:</em> <code>1</code> or <code>0</code>, <code>on</code> or <code>off</code>, <code>true</code> or <code>false</code></p>
<p>Sets <strong>all</strong> GPIO's assigned to the group number &lt;x&gt; in <strong>Configuration -&gt; <a href="../configuration/gpio/">GPIO Configuration</a></strong> to "0" or "1".</p>
<p>GUI objects that are assigned to the same group using <code>groupid</code> during object creation will change state accordingly.</p>
<h2 id="system-commands">System Commands<a class="headerlink" href="#system-commands" title="Permanent link">~</a></h2>
<div class="admonition danger">
<p class="admonition-title"><code>calibrate</code></p>
</div>
<p>Start on-screen touch calibration.</p>
<p>You need to issue a soft reboot command to save the new calibration settings. If you do a hard reset of the device, the calibration settings will be lost.</p>
<div class="admonition danger">
<p class="admonition-title"><code>screenshot</code></p>
</div>
<p>Saves a picture of the current screen to the flash filesystem. You can retrieve it via http://&lt;ip-address&gt;/screenshot.bmp.
This can be handy for bug reporting or documentation.</p>
<p>The previous screenshot is overwritten.</p>
<div class="admonition danger">
<p class="admonition-title"><code>statusupdate</code></p>
</div>
<p>Reports the status of the MCU. The response will be posted to the state topic. For example:</p>
<pre><code class="language-json">    &quot;hasp/&lt;platename&gt;/state/statusupdate&quot; =&gt; {
        &quot;node&quot;:&quot;plate35&quot;,
        &quot;idle&quot;:&quot;short&quot;,
        &quot;version&quot;:&quot;0.5.1&quot;,
        &quot;uptime&quot;:1813,
        &quot;ssid&quot;:&quot;network&quot;,
        &quot;rssi&quot;:-63,
        &quot;ip&quot;:&quot;192.168.4.2&quot;,
        &quot;heapFree&quot;:125820,
        &quot;heapFrag&quot;:35,
        &quot;core&quot;:&quot;v3.3.5-1-g85c43024c&quot;,
        &quot;canUpdate&quot;:&quot;false&quot;,
        &quot;page&quot;:1,
        &quot;numPages&quot;:12,
        &quot;tftDriver&quot;:&quot;ST7789&quot;,
        &quot;tftWidth&quot;:240,
        &quot;tftHeight&quot;:320
    }
</code></pre>
<div class="admonition danger">
<p class="admonition-title"><code>reboot</code> or <code>restart</code></p>
</div>
<p>Saves any changes in the configuration file and reboots the device.</p>
<p>!!! danger "<code>update</code>
    <em>accepted parameters:</em> <code>[url]</code></p>
<p>Update the firmware from the url provided. Reboots when update was successful.</p>
<div class="admonition danger">
<p class="admonition-title"><code>factoryreset</code></p>
</div>
<p>Clear the filesystem and EEPROM and reboot the device in its initial state.</p>
<div class="admonition note">
<p class="admonition-title">Warning</p>
<p>There is no confirmation prompt nor an undo function!</p>
</div>
<h2 id="configuration-settings">Configuration Settings<a class="headerlink" href="#configuration-settings" title="Permanent link">~</a></h2>
<h3 id="wi-fi">Wi-FI<a class="headerlink" href="#wi-fi" title="Permanent link">~</a></h3>
<div class="admonition danger">
<p class="admonition-title"><code>ssid</code></p>
</div>
<p>Set network name of the access point to connect to.</p>
<div class="admonition danger">
<p class="admonition-title"><code>pass</code></p>
</div>
<p>Set the optional password for the access point to connect to.</p>
<h3 id="mqtt">MQTT<a class="headerlink" href="#mqtt" title="Permanent link">~</a></h3>
<div class="admonition danger">
<p class="admonition-title"><code>nodename</code></p>
</div>
<p>Set the nodename of the device and mqtt topic for the node to <code>hasp/&lt;nodename&gt;/</code></p>
<div class="admonition danger">
<p class="admonition-title"><code>mqtthost</code></p>
</div>
<p>Set the IP address or nodename of the mqtt broker.</p>
<div class="admonition danger">
<p class="admonition-title"><code>mqttport</code></p>
</div>
<p>Set the port of the mqtt broker.</p>
<div class="admonition danger">
<p class="admonition-title"><code>mqttuser</code></p>
</div>
<p>Set the optional username for the mqtt broker.</p>
<div class="admonition danger">
<p class="admonition-title"><code>mqttpass</code></p>
</div>
<p>Set the optional password for the mqtt broker.</p>
<h2 id="configsubmodule">config/submodule<a class="headerlink" href="#configsubmodule" title="Permanent link">~</a></h2>
<p>You can get or set the configuration of an openHASP submodule in json format.
To get the configuration, use the command <code>config/&lt;submodule&gt;</code>. 
The result will be published to <code>hasp/&lt;nodename&gt;/state/config</code>. Passwords will be omitted from the result.</p>
<pre><code>config/wifi
config/mqtt
config/http
config/mdns
config/hasp {&quot;startdim&quot;:255}
config/gui
config/debug {&quot;tele&quot;:300}
config/gpio
</code></pre>
<p>To update the configuration simply issue the same command <code>config/&lt;submodule&gt;</code> with updated json payload.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../faq/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../faq/" class="btn btn-xs btn-link">
        FAQ
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../example-lovelace/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../example-lovelace/" class="btn btn-xs btn-link">
        Lovelace Entities
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/HASwitchPlate/openHASP-docs/tree/master/docs/commands.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>