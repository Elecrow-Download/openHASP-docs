<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Francis Van Roie">
    
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>How-To - openHASP</title> 
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
<link rel="stylesheet" href="../../css/ekko-lightbox.min.css">  
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
<script src="../../js/ekko-lightbox.min.js"></script>
 
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Installation", url: "#_top", children: [
              {title: "Configuration", url: "#configuration" },
              {title: "Services", url: "#services" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
<script>
    $(document).on('click', '[data-toggle="lightbox"]', function(event) {
        event.preventDefault();
        $(this).ekkoLightbox();
    });
</script>
 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../sampl_conf/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../sampl_conf/" class="btn btn-xs btn-link">
        Example configurations
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../styling/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../styling/" class="btn btn-xs btn-link">
        Styling
      </a>
    </div>
    
  </div>

    

    <p>The openHASP Custom Component simplifies synchronization of objects on one or more openHASP plates with Home Assistant entities.</p>
<p>You need to <a href="https://github.com/HASwitchPlate/openHASP-custom-component/archive/refs/heads/main.zip">download</a> it and install it in Home Assistant manually.</p>
<h1 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">~</a></h1>
<ol>
<li>Using the tool of choice open the directory (folder) for your HA configuration (where you find <code>configuration.yaml</code>).</li>
<li>If you do not have a <code>custom_components</code> directory there, you need to create it.</li>
<li>In the <code>custom_components</code> directory create a new folder called <code>openhasp</code>.</li>
<li>Download <em>all</em> the files from the <code>custom_components/openhasp/</code> directory in this repository.</li>
<li>Place the files you downloaded in the new directory you created.</li>
<li>Edit your <code>configuration.yaml</code> file add an entry similar to the example below.</li>
<li>Restart Home Assistant</li>
</ol>
<p>Using your Home Assustant configuration directory as a starting point you should now also have this:</p>
<pre><code class="language-text">custom_components/openhasp/__init__.py
custom_components/openhasp/common.py
custom_components/openhasp/const.py
custom_components/openhasp/light.json
custom_components/openhasp/manifest.json
custom_components/openhasp/services.yaml
</code></pre>
<hr />
<div class="admonition note">
<p class="admonition-title"><i class='fa fa-info-circle'></i>&nbsp; Note</p>
<p>We call <em>plate</em> any device running openHASP in your system.</p>
</div>
<p>Make sure you have your plates connected to the network and each of them has a unique MQTT topic. Static DHCP or fixed IP are not needed as communication only happes through MQTT. </p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">~</a></h2>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">~</a></h3>
<p>To add an openHASP plate to your installation with a sample configuration, upload a <code>pages.jsonl</code> file with the folowing content to your plate first:</p>
<pre><code class="language-text">{&quot;page&quot;:1,&quot;id&quot;:1,&quot;obj&quot;:&quot;btn&quot;,&quot;x&quot;:0,&quot;y&quot;:0,&quot;w&quot;:240,&quot;h&quot;:30,&quot;text&quot;:&quot;openHASP&quot;,&quot;value_font&quot;:22,&quot;bg_color&quot;:&quot;#2C3E50&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;radius&quot;:0,&quot;border_side&quot;:0}
{&quot;page&quot;:1,&quot;id&quot;:2,&quot;obj&quot;:&quot;btn&quot;,&quot;x&quot;:10,&quot;y&quot;:40,&quot;w&quot;:105,&quot;h&quot;:90,&quot;toggle&quot;:true,&quot;text&quot;:&quot;\uE335&quot;,&quot;text_font&quot;:26,&quot;mode&quot;:&quot;break&quot;,&quot;align&quot;:1}
{&quot;page&quot;:1,&quot;id&quot;:3,&quot;obj&quot;:&quot;dropdown&quot;,&quot;x&quot;:10,&quot;y&quot;:130,&quot;w&quot;:160,&quot;h&quot;:30,&quot;options&quot;:&quot;Apples\nBananas\nOranges\nMelon&quot;}

{&quot;page&quot;:0,&quot;id&quot;:1,&quot;obj&quot;:&quot;label&quot;,&quot;x&quot;:175,&quot;y&quot;:5,&quot;h&quot;:30,&quot;w&quot;:62,&quot;text&quot;:&quot;00.0°C&quot;,&quot;align&quot;:2,&quot;bg_color&quot;:&quot;#2C3E50&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;}
</code></pre>
<p>Assuming your plate's configured MQTT topic is <code>plate35</code>, you can add the following to your <code>configuration.yaml</code> file:</p>
<pre><code class="language-yaml">openhasp:
  plate_my_room:
    topic: &quot;hasp/plate35&quot;
    path: &quot;/config/openhasp/pages_my_room.jsonl&quot;
    idle_brightness: 35
    objects:
      - obj: &quot;p0b1&quot;  # temperature label on all pages
        properties:
          &quot;text&quot;: '{{ states(&quot;sensor.my_room_temperature&quot;) }}°C'
      - obj: &quot;p1b2&quot;  # light-switch toggle button
        properties:
          &quot;val&quot;: '{{ 1 if states(&quot;light.my_room&quot;) == &quot;on&quot; else 0 }}'
          &quot;text&quot;: '{{ &quot;\uE6E8&quot; if is_state(&quot;light.my_room&quot;, &quot;on&quot;) else &quot;\uE335&quot; | e }}'
        event:
          &quot;up&quot;:
            - service: homeassistant.toggle
              entity_id: &quot;light.my_room&quot;
      - obj: &quot;p1b3&quot;  # dropdown
        event:
          &quot;changed&quot;:
            - service: persistent_notification.create
              data:
                message: I like {{ text }}
</code></pre>
<h3 id="variable-definitions">Variable definitions<a class="headerlink" href="#variable-definitions" title="Permanent link">~</a></h3>
<p><strong>openhasp:</strong> <em>(Required)</em>  <br />
The platform identifier. Required once in the configuration, this will activate the custom component.</p>
<p><strong>plate_my_room:</strong> <em>(Required)</em>  <br />
Your plate identifier. For each plate in your sytem, such an entry is required, has to be unique.</p>
<p><strong>topic:</strong> <em>(string) (Required)</em>   <br />
The MQTT topic your plate is configured with.</p>
<p><strong>path:</strong> <em>(path) (Optional)</em>   <br />
Path to a <code>pages.jsonl</code> file containing design for this plate, to be loaded on Home Assistant start and on plate availability (becoming online).<br>
<em>Note:</em> Don't upload any <code>pages.jsonl</code> file to the plate's flash memory at all! This assumes your plate pages are empty at boot. Checkout the <em>services</em> section for requirements to use this.</p>
<p><strong>idle_brightness:</strong> <em>(int) (Optional)</em>  <br />
The brightness of the screen when idle (before long idle). Numeric value between 1 and 255. Default 25. </p>
<p><strong>objects:</strong> <em>(Optional)</em>   <br />
Definition of the objects reacting to changes in Home Assistant, or generating events for Home Assistant.</p>
<p><strong>obj:</strong> <em>(string) (Required)</em>   <br />
The object identifier which we want to integrate with Home Assistant. Its name has the form <code>pXbY</code> where <code>X</code> represents the page where the object is located, and <code>Y</code> represents the <code>id</code> of the object on that page.</p>
<p><strong>properties:</strong> <em>(Optional)</em>   <br />
List containing the properties of the object which we want to modify based on changes occurring in Home Assistant. In the example above <code>text</code> property gets updated whenever <code>sensor.my_room_temperature</code> changes. </p>
<p><strong>event:</strong> <em>(Optional)</em>   <br />
List containing the events generated by the object when touched on the screen. These are object-specific and can be observed accurately with an MQTT client. Each event defines a list of services which will be processed in order (like actions list in an automation).  </p>
<p>In the example above, when object <code>p1b2</code> (which is a toggle button) generates the <code>on</code> event, <code>light.my_room</code> will be turned on by the service call <code>light.turn_on</code> as specified in the event config. And similarily when <code>off</code> event comes through MQTT, the light will be turned off by the corresponding service call.  </p>
<div class="admonition note">
<p class="admonition-title"><i class='fa fa-info-circle'></i>&nbsp; Note</p>
<p>Any variable coming from the MQTT message can be used between curly brackets and passed to the service call. In the example above when object <code>p1b3</code> (which is a dropdown selector) generates the <code>changed</code> event, a persistent notification will appear in Home Assistant's Lovelace interface containing the selected text from the object, which was passed over from the MQTT message. See <a href="../../objects/#events">object events</a> for more types of generated events.</p>
</div>
<h3 id="configuration-tips">Configuration tips<a class="headerlink" href="#configuration-tips" title="Permanent link">~</a></h3>
<h4 id="multiple-plates">Multiple plates<a class="headerlink" href="#multiple-plates" title="Permanent link">~</a></h4>
<p>If you have multiple plates you can add them all using different plate identifiers. Their configured topics have to be unique too:</p>
<pre><code class="language-yaml">openhasp:
  plate_my_room_1:
    topic: &quot;hasp/plate1&quot;
    objects:
      ...
  plate_my_room_2:
    topic: &quot;hasp/plate2&quot;
    objects:
      ...
  plate_my_room_3:
    topic: &quot;hasp/plate3&quot;
    objects:
      ...
</code></pre>
<h4 id="split-configuration">Split configuration<a class="headerlink" href="#split-configuration" title="Permanent link">~</a></h4>
<p>You can use Home Assistant's <a href="https://www.home-assistant.io/docs/configuration/splitting_configuration/">split configuration</a> to help better organizing your config files.</p>
<p>Instead of keeping the configuration of all openHASP plates in Home Assistant's main config file, you can keep openHASP config separately, by adding only this to <code>configuration.yaml</code>:</p>
<p><code>openhasp: !include openhasp.yaml</code></p>
<p>After this, you can move your openHASP configuration starting with <code>plate_my_room:</code> level to your separate <code>openhasp.yaml</code> file and restart Home Assistant.</p>
<p>Moreover, if you have multiple plates, you can keep each one in a separate config file, to achieve this, make it like:</p>
<p><code>openhasp: !include_dir_merge_named openhasp_configs/</code></p>
<p>Create a directory <code>openhasp_configs</code> right near <code>configuration.yaml</code>, and put in it all your plates configuration (only with <code>plate_my_room:</code> level) in separate yaml files and restart Home Assistant.</p>
<hr />
<p>This component implements some specific services to make interactions with the plate even more comfortable.</p>
<h2 id="services">Services<a class="headerlink" href="#services" title="Permanent link">~</a></h2>
<p><strong>openhasp.wakeup</strong><br />
  Wakes up the display when an external event has occurred, like a presence or a PIR motion sensor.</p>
<p><strong>openhasp.next_page</strong><br />
  Changes plate to the next page.</p>
<p><strong>openhasp.prev_page</strong><br />
  Changes plate to the previous page.</p>
<p><strong>openhasp.change_page</strong><br />
  Changes plate directly to the specified page number.</p>
<p><strong>openhasp.clear_page</strong><br />
  Clears the contents of the specified page number. If page number not specified, clears all the pages.</p>
<p><strong>openhasp.load_pages</strong><br />
  Loads new design from pages.jsonl file from <em>full path</em>. <br />
  The file must be located in an authorised location defined by <a href="https://www.home-assistant.io/docs/configuration/basic/#allowlist_external_dirs">allowlist_external_dirs</a> (in case of hassio <code>/config/</code> is the directory where Home Assistant's configuration.yaml resides, so in case of a subdirectory called <code>openhasp</code> the full path would be e.g. <code>/config/openhasp/pages.jsonl</code>, and you need to add  <code>/config/openhasp/</code> to your <code>allowlist_external_dirs</code>).</p>
<div class="admonition danger">
<p class="admonition-title"><i class='fa fa-info-circle'></i>&nbsp; Warning</p>
<p>The contents of the file are loaded line by line thus <code>"page":X</code> has to be defined for each object. <br />
Unless you clear the page first, the objects will be updated.</p>
</div>
<p>Check out the example automations for further information on how to use the services within Home Assistant.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../sampl_conf/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../sampl_conf/" class="btn btn-xs btn-link">
        Example configurations
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../../styling/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../../styling/" class="btn btn-xs btn-link">
        Styling
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
      <p>
        <a href="https://github.com/HASwitchPlate/openHASP-docs/tree/master/docs/custom-component/howto.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>